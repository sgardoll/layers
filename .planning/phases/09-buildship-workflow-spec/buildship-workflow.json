{"nodes":[{"id":"39a293e2-e788-4d12-9d46-f249a0b07384","description":"Local variables allow you to store and modify values throughout a workflow. Unlike request variables, local variables are defined within the workflow and can be modified at different steps. \n\nHow to use:  \n1. In the name selector, click "Add variable" to create a new variable in your workflow.  \n2. Use the "Set Variable" node in different steps of your flow and change the value.  \n3. Reference the variable in nodes, logic or conditions. \n\nLocal variables make workflows more flexible, helping you manage dynamic data more efficiently.","inputs":{"type":"object","properties":{"name":{"description":"The name of the variable","enum":[],"title":"Name","type":"string","buildship":{"index":0}},"value":{"buildship":{"index":1},"type":"string","title":"Value","description":"The value to set the variable to"}},"required":["name","value"]},"type":"set-variable","label":"Set Variable"},{"script":"import { createClient } from \"@supabase/supabase-js\";\n\nconst WAVESPEED_URL =\n  \"https://api.wavespeed.ai/api/v3/wavespeed-ai/qwen-image/layered\";\n\nexport default async function func(inputs: any, libraries: any) {\n  const {\n    job,\n    supabaseUrl,\n    supabaseKey,\n    supabaseBucket,\n    wavespeedApiKey,\n    numLayers = 4,\n    prompt = \"\",\n    enableBase64Output = false\n  } = inputs;\n\n  try {\n    if (!job || !job.source_image_path) {\n      throw new Error(\"job.source_image_path is required\");\n    }\n\n    const filePath = job.source_image_path as string;\n\n    // 1. Download image from Supabase Storage\n    const supabase = createClient(supabaseUrl, supabaseKey);\n\n    const { data, error } = await supabase.storage\n      .from(supabaseBucket)\n      .download(filePath);\n\n    if (error) {\n      throw new Error(`Supabase download failed: ${error.message}`);\n    }\n\n    const arrayBuffer = await data.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n    const imageBase64 = buffer.toString(\"base64\");\n\n    // 2. Call Wavespeed Qwen-Image-Layered\n    const fetchImpl =\n      libraries?.fetch || (await import(\"node-fetch\")).default;\n\n    const res = await fetchImpl(WAVESPEED_URL, {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${wavespeedApiKey}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        image: imageBase64,\n        prompt,\n        num_layers: numLayers,\n        enable_sync_mode: true,\n        enable_base64_output: enableBase64Output\n      })\n    });\n\n    const json = await res.json();\n\n    if (!res.ok || json.status === \"failed\") {\n      throw new Error(\n        `Wavespeed failed: ${json.status || res.status} ${json.error || \"\"}`\n      );\n    }\n\n    const outputs: string[] = json.outputs || [];\n\n    return {\n      success: true,\n      layers: outputs,\n      wavespeedStatus: json.status || \"unknown\",\n      rawResponse: json,\n      error: \"\"\n    };\n  } catch (err: any) {\n    return {\n      success: false,\n      layers: [],\n      wavespeedStatus: \"failed\",\n      rawResponse: null,\n      error: err?.message || \"Unknown error\"\n    };\n  }\n}\n","type":"script","output":{"properties":{"layers":{"type":"array","title":"layers","buildship":{"index":1}},"error":{"type":"string","title":"error","buildship":{"index":4}},"success":{"type":"boolean","buildship":{"index":0},"title":"success"},"wavespeedStatus":{"title":"wavespeedStatus","type":"string","buildship":{"index":2}},"rawResponse":{"properties":{"data":{"type":"object","properties":{"model":{"buildship":{"index":1},"title":"model","type":"string"},"executionTime":{"type":"number","title":"executionTime","buildship":{"index":8}},"error":{"buildship":{"index":7},"title":"error","type":"string"},"outputs":{"properties":{"string":{"buildship":{"index":0},"format":"uri","title":"string","type":"string"}},"title":"outputs","buildship":{"index":2},"type":"array"},"timings":{"type":"object","properties":{"inference":{"type":"number","buildship":{"index":0},"title":"inference"}},"buildship":{"index":9},"title":"timings"},"created_at":{"buildship":{"index":6},"type":"string","format":"date-time","title":"created_at"},"status":{"buildship":{"index":5},"type":"string","title":"status"},"id":{"type":"string","title":"id","buildship":{"index":0}},"urls":{"title":"urls","buildship":{"index":3},"properties":{"get":{"buildship":{"index":0},"type":"string","title":"get","format":"uri"}},"type":"object"},"has_nsfw_contents":{"type":"array","title":"has_nsfw_contents","buildship":{"index":4}}},"title":"data","buildship":{"index":2}},"code":{"buildship":{"index":0},"title":"code","type":"number"},"message":{"title":"message","type":"string","buildship":{"index":1}}},"title":"rawResponse","type":"object","buildship":{"index":3}}},"type":"object","buildship":{"index":0}},"label":"Supabase Image to Wavespeed Qwen-Image-Layered","dependencies":{"node-fetch":"2.7.0","@supabase/supabase-js":"2.92.1-rc.2"},"description":"The Starter Script, as the name suggests, provides a blank node for adding custom logic to your workflow. \n\nClick the "code" button to configure the node. The Node Editor will open up. \n\n**Node Logic**  \nDefine the custom behavior of the node. This logic is typically written in JavaScript/TypeScript. \n\n**Inputs**  \nDefine the inputs for the node. Later in the workflow, you can pass in the values for these inputs. \n\n**Output**  \nSpecify the output format of the node (String, number, boolean, Array, Object, File) \n\n**Metadata**  \nInfo about the node (Name, ID, description, icon) \n\nLearn more about the Starter Script: [Docs](https://docs.buildship.com/core-nodes/script)","meta":{"name":"Supabase Image to Wavespeed Qwen-Image-Layered","id":"47cdfacf-205d-4b46-9604-4b547b9fbf7b","description":"pulls from Supabase Storage\n\nbase64‑encodes\n\ncalls Wavespeed\n\nreturns the layers."},"inputs":{"title":"Process Image to Layers (Script)","required":["supabaseUrl","supabaseKey","supabaseBucket","wavespeedApiKey","job"],"buildship":{"index":0},"type":"object","properties":{"supabaseUrl":{"buildship":{"index":1,"sensitive":true},"type":"string","title":"Supabase URL"},"job":{"title":"Job payload","type":"object","buildship":{"sensitive":false,"defaultExpressionType":"text","index":0},"description":"JSON object from your queue (includes source_image_path).","properties":{}},"enableBase64Output":{"buildship":{"sensitive":false,"index":7},"default":false,"title":"Enable Base64 Output","type":"boolean"},"wavespeedApiKey":{"title":"Wavespeed API Key","buildship":{"sensitive":true,"index":4},"type":"string"},"prompt":{"buildship":{"sensitive":false,"index":6},"title":"Prompt","default":"","type":"string"},"supabaseKey":{"title":"Supabase Key","type":"string","buildship":{"sensitive":true,"index":2}},"numLayers":{"type":"number","title":"Number of Layers","buildship":{"defaultExpressionType":"text","index":5,"sensitive":false},"default":4},"supabaseBucket":{"buildship":{"index":3,"sensitive":false},"type":"string","title":"Supabase Bucket"}}},"id":"47cdfacf-205d-4b46-9604-4b547b9fbf7b"},{"_groupInfo":{"surveyIntegrationCategory":"Data & Infrastructure","keyDescription":"The API Key of the Supabase instance. You can get your API Key from the [Supabase Dashboard](https://supabase.com/dashboard/projects) under Settings > API.","longDescription":"BuildShip provides pre-defined nodes for Supabase integration, allowing you to connect with your Supabase tables effortlessly. This enables you to perform various actions on your data, such as querying, inserting, updating, and deleting records, facilitating seamless data management and automation within your workflows.","uid":"supabase","acceptsKey":true,"iconUrl":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836","name":"Supabase","category":"Database","description":"Nodes for connecting with your Supabase tables and perform actions on your data.","id":"0IAjU2tekQHjibkvicpS"},"id":"efe03524-1d78-47c5-bc92-1ca8b3f86bb0","label":"Update Row","type":"script","_libRef":{"version":"6.0.1","isDirty":false,"libNodeRefId":"@buildship/update-supabase-object","buildHash":"2c31ace355453818c75acc170f8d76af1056327febd730cbc32e48f5b0bb83f3","integrity":"v3:e8e9fbd69028982552f1a4637ca2fb2e","libType":"public","src":"https://storage.googleapis.com/buildship-app-us-central1/publicLib/nodesV2/@buildship/update-supabase-object/6.0.1/build.cjs"}},{"id":"e73c03ef-e980-4f3e-94b5-db686df8e575","type":"loop","label":"Loop","nodes":[{"output":{"title":"fileBufferOutput","type":"object","buildship":{"index":0},"properties":{"type":{"title":"type","type":"string","buildship":{"index":0}},"data":{"properties":{"integer":{"title":"integer","buildship":{"index":0},"type":"number"}},"type":"array","title":"data","buildship":{"index":2}},"convertTo":{"buildship":{"index":5},"type":"object","title":"convertTo"},"size":{"type":"number","buildship":{"index":3},"title":"size"},"file":{"properties":{"type":{"title":"type","type":"string","buildship":{"index":0}}},"buildship":{"index":1},"title":"file","type":"object"},"metadata":{"buildship":{"index":4},"properties":{"mimetype":{"type":"string","title":"mimetype","buildship":{"index":0}},"url":{"title":"url","format":"uri","type":"string","buildship":{"index":1}}},"type":"object","title":"metadata"}}},"inputs":{"required":["url"],"properties":{"url":{"buildship":{"index":0},"description":"The URL of the image to download","title":"Image URL","type":"string"}},"type":"object"},"meta":{"icon":{"url":null,"type":"URL"},"name":"Download An Image From A URL And Output A Buffer","id":"download-an-image-from-a-url-and-output-a-buffer","description":"download an image from a url and output a buffer"},"label":"Download An Image From A URL And Output A Buffer","script":"export default async function downloadImageBuffer({\n    url\n}: NodeInputs) {\n    const response = await fetch(url);\n    if (!response.ok) {\n        throw new Error(`Failed to download image: ${response.status} ${response.statusText}`);\n    }\n    const arrayBuffer = await response.arrayBuffer();\n    const data = Array.from(new Uint8Array(arrayBuffer));\n    return {\n        type: \"file-buffer\",\n        file: { type: \"Buffer\" },\n        data: data,  // ✅ top-level data array\n        size: arrayBuffer.byteLength,\n        metadata: {\n            mimetype: response.headers.get('content-type') || 'application/octet-stream',\n            url: url\n        },\n        convertTo: {}\n    };\n}","id":"825e733d-d849-4b5b-8ecc-62202807b6d2","type":"script"},{"script":"import { SupabaseClient } from \"@supabase/supabase-js\";\n\ntype FileBuffer = {\n  type: string;          // e.g. \"file-buffer\"\n  file: { type: string };// e.g. { type: \"Buffer\" }\n  data: number[];        // the byte array\n  size?: number;\n  metadata?: Record<string, any>;\n  url?: string;\n};\n\nexport default async function uploadBufferToSupabase(inputs: {\n  supabaseUrl: string;\n  supabaseKey: string;\n  bucket: string;\n  filePath: string;\n  buffer: FileBuffer;\n  contentType?: string;\n}) {\n  const {\n    supabaseUrl,\n    supabaseKey,\n    bucket,\n    filePath,\n    buffer,\n    contentType,\n  } = inputs;\n\n  if (!supabaseUrl || !supabaseKey) {\n    throw new Error(\"Supabase URL and Key are required\");\n  }\n  if (!bucket) throw new Error(\"bucket is required\");\n  if (!filePath) throw new Error(\"filePath is required\");\n  if (!buffer || !buffer.data || !Array.isArray(buffer.data)) {\n    throw new Error(\"buffer must be a file-buffer object with a data array\");\n  }\n\n  const supabase = new SupabaseClient(supabaseUrl, supabaseKey);\n\n  const binary = Buffer.from(buffer.data);\n\n  const { data, error } = await supabase.storage\n    .from(bucket)\n    .upload(filePath, binary, {\n      contentType: contentType || buffer?.metadata?.mimetype || \"application/octet-stream\",\n      upsert: false,\n    });\n\n  if (error) {\n    throw new Error(`Supabase upload failed: ${error.message}`);\n  }\n\n  return {\n    success: true,\n    path: data.path,\n    bucket,\n    fullPath: `${bucket}/${data.path}`,\n  };\n}\n","type":"script","id":"fd2c0c2a-c9ce-494a-acb1-4d1debdec68f","meta":{"lifeCycleFunctions":["onExecution"],"id":"upload-buffer-to-supabase","label":"Upload Buffer to Supabase","type":"script","data":{"outputs":{},"inputs":{},"config":{}},"libRef":{"libType":"local","version":"1.0.0"},"description":"Upload a binary buffer to Supabase Storage and return the storage path.","meta":{"icon":{"type":"URL","url":null},"name":"Upload Buffer to Supabase","id":"upload-buffer-to-supabase","description":"Upload a binary buffer to Supabase Storage and return the storage path."},"script":"main.ts"},"output":{"buildship":{"index":0},"properties":{"path":{"type":"string","title":"path","buildship":{"index":1}},"fullPath":{"buildship":{"index":3},"title":"fullPath","type":"string"},"bucket":{"title":"bucket","buildship":{"index":2},"type":"string"},"success":{"buildship":{"index":0},"type":"boolean","title":"success"}},"type":"object"},"dependencies":{"@supabase/supabase-js":"2.92.1-rc.2"},"label":"Supabase Storage - Upload Buffer","description":"The Starter Script, as the name suggests, provides a blank node for adding custom logic to your workflow. \n\nClick the "code" button to configure the node. The Node Editor will open up. \n\n**Node Logic**  \nDefine the custom behavior of the node. This logic is typically written in JavaScript/TypeScript. \n\n**Inputs**  \nDefine the inputs for the node. Later in the workflow, you can pass in the values for these inputs. \n\n**Output**  \nSpecify the output format of the node (String, number, boolean, Array, Object, File) \n\n**Metadata**  \nInfo about the node (Name, ID, description, icon) \n\nLearn more about the Starter Script: [Docs](https://docs.buildship.com/core-nodes/script)","inputs":{"properties":{"supabaseKey":{"buildship":{"sensitive":true,"index":1},"type":"string","title":"Supabase Service Key","default":"","description":"Service role key (keep secret)."},"bucket":{"buildship":{"sensitive":false,"index":2},"type":"string","default":"","description":"Supabase Storage bucket.","title":"Bucket name"},"filePath":{"type":"string","default":"","title":"File path","description":"Path inside the bucket, e.g. uploads/my-file.png.","buildship":{"sensitive":false,"index":3}},"contentType":{"title":"Content type","default":"","buildship":{"sensitive":false,"index":5},"description":"Optional MIME type, e.g. image/png.","type":"string"},"supabaseUrl":{"title":"Supabase URL","buildship":{"index":0,"sensitive":false},"type":"string","description":"Your Supabase project URL.","default":""},"buffer":{"title":"File buffer","buildship":{"index":4,"sensitive":false},"type":"object","description":"Raw file buffer object (type=file-buffer, file.type=Buffer, data=number[]).","default":{}}},"sections":[],"description":"Uploads a binary buffer to Supabase Storage and returns the storage path.","type":"object","required":["supabaseUrl","supabaseKey","bucket","filePath","buffer"],"structure":[{"index":0,"parentId":null,"id":"supabaseUrl","depth":0},{"index":1,"id":"supabaseKey","parentId":null,"depth":0},{"index":2,"id":"bucket","depth":0,"parentId":null},{"index":3,"id":"filePath","parentId":null,"depth":0},{"depth":0,"index":4,"id":"buffer","parentId":null},{"id":"contentType","index":5,"depth":0,"parentId":null}],"title":"Upload Buffer to Supabase"}},{"type":"script","integrations":[],"dependencies":{},"output":{"properties":{"id":{"type":"string","buildship":{"index":0},"title":"id"},"name":{"type":"string","buildship":{"index":2},"title":"name"},"png_path":{"title":"png_path","type":"string","buildship":{"index":3}},"visible":{"buildship":{"index":8},"title":"visible","type":"boolean"},"z_index":{"buildship":{"index":7},"type":"number","title":"z_index"},"project_id":{"title":"project_id","buildship":{"index":1},"type":"string"},"height":{"type":"number","title":"height","buildship":{"index":6}},"bbox":{"title":"bbox","type":"null","buildship":{"index":9}},"created_at":{"title":"created_at","type":"string","buildship":{"index":11},"format":"date-time"},"png_url":{"buildship":{"index":4},"type":"string","title":"png_url"},"width":{"title":"width","type":"number","buildship":{"index":5}},"transform":{"buildship":{"index":10},"type":"null","title":"transform"}},"buildship":{"index":0},"type":"array"},"_groupInfo":{"iconUrl":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836","acceptsKey":true,"category":"Database","description":"Nodes for connecting with your Supabase tables and perform actions on your data.","id":"0IAjU2tekQHjibkvicpS","name":"Supabase","longDescription":"BuildShip provides pre-defined nodes for Supabase integration, allowing you to connect with your Supabase tables effortlessly. This enables you to perform various actions on your data, such as querying, inserting, updating, and deleting records, facilitating seamless data management and automation within your workflows.","surveyIntegrationCategory":"Data & Infrastructure","keyDescription":"The API Key of the Supabase instance. You can get your API Key from the [Supabase Dashboard](https://supabase.com/dashboard/projects) under Settings > API.","uid":"supabase"},"id":"f8ea8749-9c4e-47e3-9e5d-b954d5593158","_libRef":{"buildHash":"a78245bc5b7d7f248bbacac105d221e3854c9e37bc29a2c6ca03b8755de950d9","integrity":"v3:d13b25188430ffc10490c53568432fc0","libNodeRefId":"@buildship/supabase-insert-object","version":"6.0.1","isDirty":true,"libType":"public","src":"https://storage.googleapis.com/buildship-app-us-central1/publicLib/nodesV2/@buildship/supabase-insert-object/6.0.1/build.cjs"},"inputs":{"properties":{"supabaseUrl":{"buildship":{"placeholder":"https://your-supabase-url.supabase.co","sensitive":false,"index":1},"description":"The URL of your Supabase project. (Get it from your [Supabase Project](https://supabase.com/dashboard/projects) API Reference.)","properties":{},"pattern":"","title":"API URL","type":"string"},"objectData":{"type":"object","pattern":"","properties":{},"default":{},"description":"The JSON object to be inserted into the table.\n\n**SAMPLE INPUT:**\n```\n{\n  \"id\": 5,\n  \"breed\": \"Birman\",\n  \"origin\": \"Burma\",\n  \"lifespan\": 12\n}\n```\n\nOr, for multiple rows:\n```\n[\n  {\n    \"id\": 5,\n    \"breed\": \"Birman\",\n    \"origin\": \"Burma\",\n    \"lifespan\": 12\n  },\n  {\n    \"id\": 6,\n    \"breed\": \"Bombay\",\n    \"origin\": \"United States\",\n    \"lifespan\": 15\n  }\n]\n```","buildship":{"index":3,"sensitive":false},"title":"Object"},"table":{"properties":{},"title":"Table Name","description":"The name of the table in Supabase to insert the object into.","default":"users","pattern":"","type":"string","buildship":{"index":2,"sensitive":false,"placeholder":"your-table-name"}}},"required":["token","supabaseKey","supabaseUrl","table","objectData"],"sections":{},"structure":[{"index":1,"id":"supabaseUrl","depth":0,"parentId":null},{"id":"table","depth":0,"parentId":null,"index":2},{"parentId":null,"index":3,"depth":0,"id":"objectData"}],"type":"object"},"script":"import fetch from \"node-fetch\";\nexport default async function supabaseInsertObject(\n  { table, objectData, supabaseUrl }: NodeInputs,\n  { auth, logging }: NodeScriptOptions,\n): NodeOutput {\n  const supaUrl = `${supabaseUrl}/rest/v1/${table}`;\n  const apiKey = auth.getKey();\n  if (apiKey === undefined) {\n    throw new Error(\"Please select a key for this node.\");\n  }\n  const headers = {\n    apikey: apiKey,\n    \"Authorization\": `Bearer ${apiKey}`,\n    \"Content-Type\": \"application/json\",\n    Prefer: \"return=representation\",\n  };\n\n  const requestData = objectData;\n\n  try {\n    const response = await fetch(supaUrl, {\n      method: \"POST\",\n      headers: headers,\n      body: JSON.stringify(requestData),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      logging.error(\"Error:\", errorData);\n      return errorData;\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    logging.error(\"Error:\", error);\n    throw error;\n  }\n}","label":"Create Row","meta":{"description":"Add new row(s) to your Supabase table.","icon":{"type":"URL","url":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836"},"name":"Create Row","id":"supabase-insert-object"}}],"description":"The Loop node processes each element in the input data sequentially, applying specified actions. Ideal for step-by-step transformations and ordered execution. \n\nLearn more about the Loop node: [Docs](https://docs.buildship.com/core-nodes/loop)"},{"_libRef":{"isDirty":false,"integrity":"v3:e8e9fbd69028982552f1a4637ca2fb2e","buildHash":"2c31ace355453818c75acc170f8d76af1056327febd730cbc32e48f5b0bb83f3","libNodeRefId":"@buildship/update-supabase-object","libType":"public","version":"6.0.1","src":"https://storage.googleapis.com/buildship-app-us-central1/publicLib/nodesV2/@buildship/update-supabase-object/6.0.1/build.cjs"},"type":"script","id":"62fec0db-012e-4a98-aea1-2bc5b6f780eb","label":"Update Row","_groupInfo":{"iconUrl":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836","longDescription":"BuildShip provides pre-defined nodes for Supabase integration, allowing you to connect with your Supabase tables effortlessly. This enables you to perform various actions on your data, such as querying, inserting, updating, and deleting records, facilitating seamless data management and automation within your workflows.","category":"Database","id":"0IAjU2tekQHjibkvicpS","keyDescription":"The API Key of the Supabase instance. You can get your API Key from the [Supabase Dashboard](https://supabase.com/dashboard/projects) under Settings > API.","name":"Supabase","description":"Nodes for connecting with your Supabase tables and perform actions on your data.","surveyIntegrationCategory":"Data & Infrastructure","acceptsKey":true,"uid":"supabase"}},{"type":"output","label":"Flow Output","id":"48f3e8a3-1952-4892-ab75-aa476f8ce24c"}],"triggers":[{"setupPreview":"<div\n  style={{\n    margin: \"22px\",\n    padding: \"24px\",\n    backgroundColor: props.theme.palette.elevation.contextMenu,\n    boxShadow: \"0px 4px 16px 0px rgba(0, 0, 0, 0.08)\",\n    borderRadius: \"16px\",\n  }}\n>\n  <Typography sx={{ marginBottom: \"8px\" }}>\n  Your trigger is ready!\n  </Typography>\n    <Typography sx={{\n      color: props.theme.palette.text[400]\n    }}>\n      {`This workflow will run every time and event like ${props.triggerValues?.[\"config.events\"].length > 0 ? props.triggerValues?.[\"config.events\"].join(\", \") : \"\"} happens on Supabase table ${props.triggerValues?.[\"config.table\"]}.`}\n    </Typography>\n    \n\n  <div style={{ \n    height: \"1px\",\n    marginTop: \"24px\"\n  }}\n  ></div>\n  <InputsBinder header=\"Get the latest request\" description=\"You can use received data to customize your input schema. To start do any of the events described before or click get data\" trigger={props.trigger}     resultHeader=\"Select the paths to update your input schema\" resultDescription=\"No data received yet!\" />\n</div>\n","icon":{"url":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836","type":"URL"},"type":"webhook","integrations":["supabase"],"meta":{"id":"supabase-webhook","description":"Creates a database webhook on Supabase. In other words, this workflow will be executed when there is an event on the provided table. [Full Documentation](https://docs.buildship.com/trigger-nodes/supabase-trigger)","icon":{"type":"URL","url":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836"},"name":"Supabase Trigger"},"preSetupPreview":"<div\n  style={{\n    margin: \"22px\",\n    height: \"100%\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"column\",\n  }}\n>\n<div\n\tstyle={{\n\t\tdisplay: \"flex\",\n\t\talignItems: \"center\",\n\t\tjustifyContent: \"center\",\n\t\tflexDirection: \"column\",\n\t\tpadding: \"22px\",\n\t\twidth: \"100%\",\n        maxWidth: \"420px\"\n\t}}\n>\n\n\t<div\n\t\tstyle={{\n\t\t\tpadding: \"16px 16px\",\n\t\t\tbackgroundColor: props.theme.palette.elevation.contextMenu,\n\t\t\tboxShadow: \"0px 4px 16px 0px rgba(0, 0, 0, 0.08)\",\n\t\t\tborderRadius: \"16px\",\n\t\t\twidth: \"100%\",\n\t\t}}\n\t>\n    <div\n      style={{\n        display: \"flex\",\n        padding: \"8px\",\n        backgroundColor: props.theme.palette.text[50],\n        borderRadius: \"8px\",\n        width: \"fit-content\"\n      }}\n  >\n    <img src=\"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836\" width=\"16\" height=\"16\" />\n  </div>\n\t\t<Typography sx={{ my: 2 }}>\n\t\t\tSupabase Trigger - Quick Set Up Guide\n\t\t</Typography>\n      <Typography sx={{ mb: -1.2 }}>{\"1. Sign into your Supabase Account\"}</Typography>\n\t\t<Typography\n\t\t\tsx={(theme) => ({\n\t\t\t\tcolor: theme.palette.text[400]\n\t\t\t})}\n\t\t>\n\t\t\tClick on the **Authenticate** button to log into your Supabase Account.\n\t\t</Typography>\n\n      <Typography sx={{ mt: 2, mb: -1.2 }}>2. Get your **Supabase Project Ref**</Typography>\n\t\t<Typography\n\t\t\tsx={(theme) => ({\n\t\t\t\tcolor: theme.palette.text[400]\n\t\t\t})}\n\t\t>\n        Go to your [Supabase Project](https://supabase.com/dashboard/project) and copy the project ref ID found after `project/{ref-id}`. Copy and paste it in.\n\t\t</Typography>\n\n    <img src=\"https://storage.googleapis.com/buildship-47gwwm-us-central1/trigger assets/supabase-config.png\" width=\"100%\" \n      style={{\n        width: '100%',\n        maxWidth: '500px',\n        borderRadius: '8px',\n      }} \n    />\n\n      <Typography sx={{ mt: 2, mb: -1.2 }}>3. Add Table Schema and Name</Typography>\n\t\t<Typography\n\t\t\tsx={(theme) => ({\n\t\t\t\tcolor: theme.palette.text[400]\n\t\t\t})}\n\t\t>\n          Navigate to your [Supabase Project](https://supabase.com/dashboard/project) > Database > Schema Visualizer to check out the schema for the table you wish to set up the Supabase Trigger for.\n\t\t</Typography>\n\t</div>\n</div>\n</div>\n  ","version":"2.0.0","response":{"properties":{},"type":"object","required":[]},"config":{"properties":{"events":{"buildship":{"index":1,"sensitive":false,"options":[{"value":"insert","label":"Insert"},{"label":"Update","value":"update"},{"value":"delete","label":"Delete"}]},"properties":{},"description":"The event on the table after which this workflow will be triggered.","default":["insert"],"type":"array","enum":["insert","update","delete"],"title":"Events","pattern":""},"schema":{"default":"public","title":"Table Schema","description":"The postgres schema to which the table belongs. [More info](https://supabase.com/docs/guides/database/tables#schemas)","type":"string","pattern":"","buildship":{"index":2,"sensitive":false}},"projectRef":{"default":"","type":"string","pattern":"","buildship":{"sensitive":false,"index":0},"title":"Project Ref","description":"Project reference which can be obtained from the Supabase dashboard."},"table":{"pattern":"","default":"","description":"Name of the table","type":"string","buildship":{"sensitive":false,"index":3},"title":"Table Name"}},"required":["method","schema","table","projectRef","events"],"type":"object"},"description":"Creates a database webhook on Supabase. In other words, this workflow will be executed when there is an event on the provided table. [Full Documentation](https://docs.buildship.com/trigger-nodes/supabase-trigger)","_libRef":{"libType":"public","integrity":"v3:b16ae33f9192d05148525142b2da5054","isDirty":false,"libNodeRefId":"@buildship/supabase-webhook","version":"3.0.0","src":"https://storage.googleapis.com/buildship-library-us-central1/triggers/@buildship/supabase-webhook/3.0.0/__verify.cjs"},"lastDeploymentHash":"xdRI0lTekrl4SYFUtemd2YPH9QMipJ8bxiw4uSp1C+A=","preview":"<div\n  style={{\n    margin: \"22px\",\n    padding: \"24px 42px\",\n    marginTop: \"240px\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"column\",\n  }}\n>\n  <div\n    style={{\n      height: \"32px\",\n      padding: \"8px\",\n      backgroundColor: props.theme.palette.text[50],\n      borderRadius: \"8px\",\n    }}\n  >\n    <img\n      src=\"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836\"\n      alt=\"YouTube Icon\"\n      style={{\n        width: \"16px\", // Adjust the size as needed\n        height: \"16px\",\n      }}\n    />\n  </div>\n  <br />\n  <Typography\n    sx={(theme) => ({\n      ...theme.typography.body,\n      color: props.theme.palette.text[400],\n      textAlign: \"center\",\n    })}\n  >\n    This workflow is triggered by events like insertions, updates, or deletions on a Supabase table, automating corresponding actions in BuildShip.\n  </Typography>\n</div>\n","name":"Supabase Trigger","data":{"buildship":{},"properties":{"schema":{"title":"schema","type":"string","buildship":{"index":2},"description":""},"type":{"buildship":{"index":0},"description":"","title":"type","type":"string"},"record":{"buildship":{"index":3},"title":"record","type":"object","description":"","properties":{}},"table":{"buildship":{"index":1},"description":"","type":"string","title":"table"},"old_record":{"buildship":{"index":4},"title":"old_record","properties":{},"type":"object","description":""}},"type":"object","title":"Request Body","description":""},"id":"9e915347-768e-48c7-a4a1-1dd33c4230f9","integrity":"v3:0d03089674bac4cac2ff11581f4ee467","script":"import parser from \"co-body\";\n\nconst BASE_URL = \"https://api.supabase.com\";\n\nasync function onCreate(\n\t{ projectRef, schema, events, table },\n\t{ auth, runtimeUrl, workflow, trigger }\n) {\n\tconst { access_token } = await auth.getToken();\n\n\tconst enableWebhookResp = await fetch(\n\t\tBASE_URL + `/v1/projects/${projectRef}/database/webhooks/enable`,\n\t\t{\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${access_token}`,\n\t\t\t},\n\t\t\tmethod: \"POST\",\n\t\t}\n\t);\n\n\tif (!enableWebhookResp.ok) {\n\t\t// Removed console.log with potentially sensitive information\n\t}\n\n\tconst webhookUrl = `${runtimeUrl}/executeWorkflow/${workflow.id}/${trigger.id}`;\n\n\tconst addWebhookResp = await fetch(\n\t\tBASE_URL + `/v1/projects/${projectRef}/database/query`,\n\t\t{\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${access_token}`,\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t\tmethod: \"POST\",\n\t\t\tbody: JSON.stringify({\n\t\t\t\tquery: `\n        create or replace trigger \"${workflow.id}/${\n\t\t\t\t\ttrigger.id\n\t\t\t\t}\" after ${events.join(\" OR \")}\n        on \"${schema}\".\"${table}\" for each row\n        execute function \"supabase_functions\".\"http_request\"(\n          '${webhookUrl}',\n          'POST',\n          '{\"Content-Type\":\"application/json\"}',\n          '{}',\n          '5000'\n        );\n        `\n\t\t\t\t\t.replace(/(\\r\\n|\\n|\\r)/gm, \" \")\n\t\t\t\t\t.replace(/\\s{2,}/gm, \" \"),\n\t\t\t}),\n\t\t}\n\t);\n\n\treturn true;\n}\n\nasync function onExecution({ _ }, { auth, nodeReq }) {\n\treturn await parser[\"json\"](nodeReq);\n}\n\nasync function onDelete(\n\t{ projectRef, schema, events, table },\n\t{ auth, workflow, logging }\n) {\n\tconst { access_token } = await auth.getToken();\n\tconst res = await fetch(\n\t\tBASE_URL + `/v1/projects/${projectRef}/database/query`,\n\t\t{\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${access_token}`,\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t},\n\t\t\tmethod: \"POST\",\n\t\t\tbody: JSON.stringify({\n\t\t\t\tquery: `drop trigger if exists \"${workflow.id}\" on \"${schema}\".\"${table}\";`,\n\t\t\t}),\n\t\t}\n\t);\n\n\tif (!res.ok) {\n\t\tthrow new Error(`Error: ${await res.text()}`);\n\t}\n\n\treturn true;\n}\n\nconst getAccessToken = async () => {\n\tconst response = await fetch(\n\t\t\"http://metadata/computeMetadata/v1/instance/service-accounts/default/token\",\n\t\t{\n\t\t\theaders: { \"Metadata-Flavor\": \"Google\" },\n\t\t}\n\t);\n\n\tif (!response.ok) {\n\t\tthrow new Error(\n\t\t\t`Failed to obtain access token: ${response.statusText}`\n\t\t);\n\t}\n\n\tconst data = await response.json();\n\treturn data.access_token;\n};\n\nconst fetchLogEntries = async (triggerId, retries = 3, delay = 1000) => {\n\tconst projectId = process.env.GCLOUD_PROJECT;\n\tconst accessToken = await getAccessToken();\n\n\tconst filter = `logName=\"projects/${projectId}/logs/buildship-node-io\" AND jsonPayload.nId=\"${triggerId}\"`;\n\n\tconst requestBody = {\n\t\tresourceNames: [`projects/${projectId}`], // Added resourceNames field\n\t\tfilter: filter,\n\t\tpageSize: 1,\n\t\torderBy: \"timestamp desc\",\n\t};\n\n\tfor (let attempt = 1; attempt <= retries; attempt++) {\n\t\ttry {\n\t\t\tconst response = await fetch(\n\t\t\t\t\"https://logging.googleapis.com/v2/entries:list\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: `Bearer ${accessToken}`,\n\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t},\n\t\t\t\t\tbody: JSON.stringify(requestBody),\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tconst errorText = await response.text();\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Error fetching log entries: ${response.statusText} - ${errorText}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst entries = data.entries || [];\n\n\t\t\tif (entries.length > 0) {\n\t\t\t\treturn entries;\n\t\t\t}\n\n\t\t\t// Delay before the next attempt if entries were empty\n\t\t\tif (attempt < retries) {\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(`Attempt ${attempt} failed due to an error:`, error);\n\t\t\t// Retry if it's not the last attempt\n\t\t\tif (attempt < retries) {\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\n\t\t\t} else {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Failed to get data after ${retries} attempts.`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t// If all retries exhausted and no entries found\n\tthrow new Error(\"No data found. Send a request to the API and try again.\");\n};\n\nconst getData = async (inputs, { trigger, workflow }) => {\n\ttry {\n\t\tconst entries = await fetchLogEntries(trigger.id, 5, 2000);\n\t\treturn { success: true, message: \"\", data: entries[0].jsonPayload.o };\n\t} catch (err) {\n\t\treturn { success: false, message: err?.message, data: null };\n\t}\n};\n\nexport default {\n\tonCreate,\n\tonExecution,\n\tonUpdate: onCreate,\n\tonDelete,\n\tgetData,\n};","lifeCycleFunctions":["onCreate","onExecution","onUpdate","onDelete","getData"],"dependencies":{"co-body":"6.2.0"},"label":"Supabase Trigger","_groupInfo":{"category":"Database","uid":"supabase","description":"Nodes for connecting with your Supabase tables and perform actions on your data.","iconUrl":"https://firebasestorage.googleapis.com/v0/b/website-a1s39m.appspot.com/o/buildship-app-logos%2Fsupabase.png?alt=media&token=db017867-8867-4e74-8e94-c7074c82b836","keyDescription":"The API Key of the Supabase instance. You can get your API Key from the [Supabase Dashboard](https://supabase.com/dashboard/projects) under Settings > API.","id":"0IAjU2tekQHjibkvicpS","longDescription":"BuildShip provides pre-defined nodes for Supabase integration, allowing you to connect with your Supabase tables effortlessly. This enables you to perform various actions on your data, such as querying, inserting, updating, and deleting records, facilitating seamless data management and automation within your workflows.","acceptsKey":true,"name":"Supabase","surveyIntegrationCategory":"Data & Infrastructure"},"groupId":"supabase","groups":[{"uid":"supabase"}],"checkedAt":"2025-07-09T00:17:47.620Z","usage":"","order":11}],"nodeValues":{"825e733d-d849-4b5b-8ecc-62202807b6d2":{"url":{"_$keys_":["e73c03ef-e980-4f3e-94b5-db686df8e575","item"]}},"62fec0db-012e-4a98-aea1-2bc5b6f780eb":{"table":"projects","filter":{"type":"javascript","_$expression_":"`id=eq.${ctx?.[\"root\"]?.[\"state\"]?.[\"project_id\"]}`","hasErrors":false},"data":{"status":"ready"},"kbIntegrationKey":"supabase;;supabase-key-layers","oAuthIntegrations":{},"supabaseUrl":"https://dbluxquekhkihatcjplz.supabase.co"},"39a293e2-e788-4d12-9d46-f249a0b07384":{"name":"project_id","value":{"hasErrors":false,"_$expression_":"ctx?.[\"root\"]?.[\"inputs\"]?.[\"record\"].id","type":"javascript"}},"48f3e8a3-1952-4892-ab75-aa476f8ce24c":{"_$bsStatusCode_":"200","_$bsCacheMaxAge_":0,"_$lastNodeOutput_":{"_$keys_":["62fec0db-012e-4a98-aea1-2bc5b6f780eb"]}},"efe03524-1d78-47c5-bc92-1ca8b3f86bb0":{"filter":{"hasErrors":false,"_$expression_":"`id=eq.${ctx?.[\"root\"]?.[\"state\"]?.[\"project_id\"]}`","type":"javascript"},"kbIntegrationKey":"supabase;;supabase-key-layers","oAuthIntegrations":{},"data":{"status":"processing"},"supabaseUrl":"https://dbluxquekhkihatcjplz.supabase.co","table":"projects"},"e73c03ef-e980-4f3e-94b5-db686df8e575":{"items":{"_$keys_":["47cdfacf-205d-4b46-9604-4b547b9fbf7b","rawResponse","data","outputs"]},"concurrency":1},"47cdfacf-205d-4b46-9604-4b547b9fbf7b":{"prompt":"","numLayers":4,"supabaseBucket":"source-images","enableBase64Output":false,"supabaseKey":{"_$secretName_":"supabase-layers"},"job":{"_$keys_":["inputs","record"]},"wavespeedApiKey":{"_$secretName_":"wavespeed-layers"},"supabaseUrl":"https://dbluxquekhkihatcjplz.supabase.co"},"9e915347-768e-48c7-a4a1-1dd33c4230f9":{"config.projectRef":"dbluxquekhkihatcjplz","config.table":"projects","oAuthIntegrations":{"supabase":"supabase;;c8049c67"},"inputs.record":{"_$schema_":[],"_$expression_":"ctx?.[\"root\"]?.[\"9e915347-768e-48c7-a4a1-1dd33c4230f9\"]?.[\"record\"]"},"config.schema":"public","config.events":["insert"]},"4e189c15-122f-4723-9747-81d80ed0986b":{"kbIntegrationKey":"supabase;;supabase-key-sgardoll"},"f8ea8749-9c4e-47e3-9e5d-b954d5593158":{"oAuthIntegrations":{},"objectData":{"_$expression_":"{\n  project_id: ctx?.[\"root\"]?.[\"inputs\"]?.[\"record\"]?.id,\n  name: `Layer ${ctx?.[\"root\"]?.[\"e73c03ef-e980-4f3e-94b5-db686df8e575\"]?.[\"index\"] + 1}`,\n  png_path: ctx?.[\"root\"]?.[\"e73c03ef-e980-4f3e-94b5-db686df8e575\"]?.[\"fd2c0c2a-c9ce-494a-acb1-4d1debdec68f\"]?.[\"path\"],\n  png_url: ctx?.[\"root\"]?.[\"e73c03ef-e980-4f3e-94b5-db686df8e575\"]?.[\"fd2c0c2a-c9ce-494a-acb1-4d1debdec68f\"]?.[\"fullPath\"],\n  width: 0,\n  height: 0,\n  z_index: ctx?.[\"root\"]?.[\"e73c03ef-e980-4f3e-94b5-db686df8e575\"]?.[\"index\"],\n  visible: true,\n  bbox: null,\n  transform: null\n}\n","type":"javascript","hasErrors":false},"table":"project_layers","supabaseUrl":"https://dbluxquekhkihatcjplz.supabase.co","kbIntegrationKey":"supabase;;supabase-key-layers"},"fd2c0c2a-c9ce-494a-acb1-4d1debdec68f":{"supabaseUrl":"https://dbluxquekhkihatcjplz.supabase.co","filePath":{"_$expression_":"`${ctx?.[\"root\"]?.[\"inputs\"]?.[\"record\"]?.user_id}/${ctx?.[\"root\"]?.[\"inputs\"]?.[\"record\"]?.id}/layer_${ctx?.[\"root\"]?.[\"e73c03ef-e980-4f3e-94b5-db686df8e575\"]?.[\"index\"]}.png`","type":"javascript","hasErrors":false},"contentType":"","bucket":"layers","supabaseKey":{"_$secretName_":"supabase-layers"},"buffer":{"_$keys_":["e73c03ef-e980-4f3e-94b5-db686df8e575","825e733d-d849-4b5b-8ecc-62202807b6d2"]}}},"runtimeVersion":"v3","outputs":{"required":[],"properties":{"output":{"buildship":{"index":0},"title":"Output"}},"type":"object"},"inputs":{"required":["record"],"properties":{"record":{"properties":{},"title":"Record","type":"object","buildship":{"index":0}}},"type":"object"},"variables":{"_$bsStatusCode_":{"buildship":{"index":0},"type":"string","title":"Flow Output Status Code"},"project_id":{"type":"string","buildship":{}},"_$bsCacheMaxAge_":{"title":"Flow Output Cache Time","default":0,"type":"number","buildship":{"index":0}}},"stickyNotes":{}}
