---
phase: 15.2-app-store-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [
  lib/screens/paywall_screen.dart,
  lib/widgets/export_purchase_sheet.dart,
  pubspec.yaml,
  assets/legal/privacy-policy.html,
  assets/legal/terms-of-use.html
]
autonomous: true
---

<objective>
Add App Store-compliant privacy policy and Terms of Use (EULA) links to subscription and purchase flows.

Purpose: Address App Store Review Guideline 3.1.2 by providing required legal information in the app's purchase flow.

Output: Functional legal links in paywall and export purchase screens, hosted legal documents.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/screens/paywall_screen.dart
@lib/widgets/export_purchase_sheet.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Privacy Policy and EULA documents</name>
  <files>assets/legal/privacy-policy.html, assets/legal/terms-of-use.html</files>
  <action>
    Create two HTML legal documents in assets/legal/ directory:
    
    1. privacy-policy.html - Standard privacy policy covering:
       - What data is collected (email, images, usage)
       - How data is used (AI processing, storage)
       - Data storage (Supabase, secure)
       - Third parties (RevenueCat for payments, BuildShip for processing)
       - User rights (access, delete account)
       - Contact information
    
    2. terms-of-use.html - EULA covering:
       - License grant (personal use)
       - Subscription terms (auto-renewal, cancellation)
       - Acceptable use (no illegal content)
       - Disclaimer of warranties
       - Limitation of liability
       - Governing law
       - Contact information
    
    Use standard app legal language. Keep it professional but readable.
  </action>
  <verify>Files exist at assets/legal/privacy-policy.html and assets/legal/terms-of-use.html with proper HTML structure and legal content</verify>
  <done>Both legal documents created with appropriate content for a Flutter app with subscriptions and AI image processing</done>
</task>

<task type="auto">
  <name>Task 2: Add url_launcher dependency</name>
  <files>pubspec.yaml</files>
  <action>
    Add url_launcher package to pubspec.yaml dependencies:
    url_launcher: ^6.2.5
    
    Run flutter pub get to install.
  </action>
  <verify>url_launcher appears in pubspec.yaml dependencies and flutter pub get succeeds</verify>
  <done>url_launcher package added and installed</done>
</task>

<task type="auto">
  <name>Task 3: Add legal links to paywall screen</name>
  <files>lib/screens/paywall_screen.dart</files>
  <action>
    Modify paywall_screen.dart to add legal links at the bottom:
    
    1. Import url_launcher: import 'package:url_launcher/url_launcher.dart';
    
    2. Add legal text after the subscription terms paragraph:
       "By subscribing, you agree to our Terms of Use and Privacy Policy"
    
    3. Make "Terms of Use" and "Privacy Policy" clickable TextSpans using RichText or GestureDetector
    
    4. Create helper function to launch URLs:
       Future<void> _launchUrl(String url) async {
         if (!await launchUrl(Uri.parse(url), mode: LaunchMode.externalApplication)) {
           throw Exception('Could not launch $url');
         }
       }
    
    5. Use hosted URLs (placeholder for now, will update in Task 5):
       - Terms: https://your-domain.com/terms-of-use
       - Privacy: https://your-domain.com/privacy-policy
    
    Style: Use theme color for links, underline to indicate clickable.
  </action>
  <verify>Paywall screen shows legal links at bottom, tapping them attempts to open URLs</verify>
  <done>Paywall screen includes clickable Terms of Use and Privacy Policy links</done>
</task>

<task type="auto">
  <name>Task 4: Add legal links to export purchase sheet</name>
  <files>lib/widgets/export_purchase_sheet.dart</files>
  <action>
    Modify export_purchase_sheet.dart to add same legal links pattern:
    
    1. Import url_launcher
    2. Add legal text after purchase button:
       "By purchasing, you agree to Terms of Use and Privacy Policy"
    3. Make links clickable with same _launchUrl helper
    4. Use same URLs as paywall
    
    Keep styling consistent with paywall screen.
  </action>
  <verify>Export purchase sheet shows legal links, tapping opens URLs</verify>
  <done>Export purchase sheet includes legal links</done>
</task>

<task type="auto">
  <name>Task 5: Configure URLs and test links</name>
  <files>lib/screens/paywall_screen.dart, lib/widgets/export_purchase_sheet.dart</files>
  <action>
    1. Choose hosting option for legal documents:
       - Option A: Host on Supabase storage (public bucket)
       - Option B: GitHub Pages
       - Option C: Current app domain
    
    2. Update URL constants in both files to point to hosted documents
    
    3. Test that links open correctly in mobile browser
    
    For Supabase storage option:
    - Upload HTML files to storage bucket 'public'
    - Get public URLs
    - Update code with actual URLs
  </action>
  <verify>Links open actual hosted documents in external browser when tapped</verify>
  <done>Legal documents hosted and URLs configured in app</done>
</task>

<task type="auto">
  <name>Task 6: Verify build and functionality</name>
  <files>lib/screens/paywall_screen.dart, lib/widgets/export_purchase_sheet.dart</files>
  <action>
    1. Run flutter analyze to check for errors
    2. Build app for iOS: flutter build ios --simulator
    3. Verify no compilation errors
    4. Check that paywall and export sheet still render correctly
  </action>
  <verify>flutter analyze passes with no errors, app builds successfully</verify>
  <done>Build passes, all functionality intact</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] flutter analyze passes with no errors
- [ ] flutter build ios succeeds
- [ ] Privacy policy document created and hosted
- [ ] Terms of Use document created and hosted
- [ ] Paywall screen shows legal links
- [ ] Export purchase sheet shows legal links
- [ ] Links open documents in external browser
- [ ] UI looks good and matches app theme
</verification>

<success_criteria>
- Legal documents created with appropriate content
- url_launcher package integrated
- Paywall screen includes Terms of Use and Privacy Policy links
- Export purchase sheet includes legal links
- Links open hosted documents correctly
- App builds without errors
- UI remains polished and professional
</success_criteria>

<output>
After completion, create `.planning/phases/15-app-store-compliance/15.2-01-SUMMARY.md`

Include:
- Legal document URLs (hosted location)
- Screenshots of paywall with legal links
- Any issues encountered
- Notes for App Store metadata updates (manual steps)
</output>
