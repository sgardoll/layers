# UAT Issues: Phase 15.1 Anonymous RLS Fix + Logout Fix Regression

**Tested:** 2026-02-03
**Source:** 15.1-01-SUMMARY.md + Logout Fix (2026-02-01)
**Tester:** User via /gsd-verify-work (macOS/iOS)
**Status:** ✅ FIXES APPLIED - READY FOR RE-TEST

## Open Issues

[None - all issues have fixes applied]

## Resolved Issues

### UAT-001: Anonymous project creation fails silently

**Discovered:** 2026-02-03
**Resolved:** 2026-02-03
**Phase/Plan:** 15.1-01
**Fix:** Added `_buildAnonymousEmptyState()` in `project_screen.dart` that shows sign-in prompt for unauthenticated users with option to continue as guest.

### UAT-002: Pro users incorrectly show "Free" status

**Discovered:** 2026-02-03
**Resolved:** 2026-02-03
**Phase/Plan:** 15.1-01
**Fix:** Modified `entitlementProvider` in `entitlement_provider.dart` to properly wait for `linkedRevenueCatServiceProvider` to complete before checking entitlements, eliminating race condition.

### UAT-003: NEW USERS/ANONYMOUS USERS INCORRECTLY SHOWN AS PRO — CRITICAL BILLING FRAUD

**Discovered:** 2026-02-03
**Resolved:** 2026-02-03
**Phase/Plan:** 15.1-01
**Fix:** Added `else { await service.logOut(); }` block in `linkedRevenueCatServiceProvider` to explicitly clear cached entitlements when user logs out.

### UAT-004: Projects don't appear after login

**Discovered:** 2026-02-03
**Resolved:** 2026-02-03
**Phase/Plan:** 15.1-01
**Fix:** Added auth state listener to `ProjectListNotifier` that auto-loads projects when user logs in, and updated `projectListProvider` to pass `ref` to the notifier.

### UAT-005: 3D Viewer schematic labels reversed

**Discovered:** 2026-02-03
**Resolved:** 2026-02-03
**Phase/Plan:** 15.1-01
**Fix:** Changed label format from `'Layer ${index + 1}'` to `'Layer ${totalLayers - index}'` in `layer_card_3d.dart` so Layer 1 appears in front.

---

## Summary

| Test | Original Result | Status |
|------|-----------------|--------|
| Anonymous project creation | ❌ FAIL | ✅ Fixed |
| 3D viewer layer ordering | ⚠️ PARTIAL | ✅ Fixed |
| Pro status after logout | ✅ PASS | Working correctly |
| Project data after logout | ✅ PASS | Working correctly |
| Projects after login | ❌ FAIL | ✅ Fixed |
| New user Pro inheritance | ❌❌ CRITICAL | ✅ Fixed |
| Pro users showing Free | ❌ CRITICAL | ✅ Fixed |

---

## Verdict

✅ **FIXES APPLIED - READY FOR RE-TEST**

All 5 UAT issues have been resolved:

1. ✅ **UAT-003 (Billing Fraud)** — RevenueCat now explicitly logs out when user is null
2. ✅ **UAT-002 (Pro shows Free)** — Race condition fixed with proper async handling
3. ✅ **UAT-004 (Projects broken)** — Auth listener added to auto-load on login
4. ✅ **UAT-001 (Anonymous creation)** — Anonymous empty state with sign-in prompt
5. ✅ **UAT-005 (Labels reversed)** — Index calculation corrected

**Commit:** fd1607e

---

*Phase: 15.1-anonymous-rls-fix*
*Plan: 01*
*Fixed: 2026-02-03*
*Verdict: FIXES APPLIED - READY FOR RE-TEST*
