---
phase: 20-per-export-pricing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false
domain: flutter
---

<objective>
Configure RevenueCat dashboard with consumable product for export credits and document configuration steps.

Purpose: Enable $0.50 per-export consumable IAP as additional monetization alongside subscriptions.
Output: RevenueCat dashboard configured with 'layers_export' consumable product ($0.49/$0.50), documentation of configuration.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
@~/.config/opencode/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/services/revenuecat_service.dart

**Requirements from ROADMAP:**
- MON-03: RevenueCat consumable configuration
- MON-06: Restore purchases must work for consumables

**Existing RevenueCat setup:**
- RevenueCatService already has getExportPackage() and purchaseExportCredit() methods
- Expects offering named 'export_credits' with package 'layers_export'
- Already handles consumable purchase flow (no entitlement check)

**Product requirements:**
- Price: $0.49 USD (Apple) / $0.50 USD (Google) to cover fees
- Type: Consumable (can be purchased multiple times)
- Identifier: 'layers_export' (matches code expectation)
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <decision>Configure RevenueCat consumable product in dashboard</decision>
  <context>
RevenueCat dashboard configuration cannot be automated via API. Manual steps required to create the consumable IAP product.

Steps to complete:
1. Log into RevenueCat dashboard (app.revenuecat.com)
2. Navigate to your project > offerings
3. Create new offering named 'export_credits'
4. Add package named 'layers_export' with consumable product
5. Configure App Store Connect product (if not done)
6. Configure Google Play Console product (if not done)
  </context>
  <options>
    <option id="configured">
      <name>Dashboard configured</name>
      <pros>Can proceed with testing; offering 'export_credits' with package 'layers_export' is ready</pros>
      <cons>Requires manual work now</cons>
    </option>
    <option id="skip">
      <name>Skip for now</name>
      <pros>Continue with code implementation; configure dashboard later</pros>
      <cons>Export purchase flow won't work until configured</cons>
    </option>
  </options>
  <resume-signal>Select: configured or skip</resume-signal>
</task>

<task type="auto">
  <name>Task 1: Document RevenueCat configuration</name>
  <files>.planning/phases/20-per-export-pricing/revenuecat-config.md</files>
  <action>
Create documentation file with complete RevenueCat setup instructions:

## RevenueCat Consumable Configuration

### Dashboard Setup
1. Go to app.revenuecat.com
2. Select your project
3. Products > Add new product:
   - Identifier: `layers_export`
   - Display Name: "Export Credit"
   - Description: "Single export credit for one-time layer export"
   
4. Offerings > Add offering:
   - Identifier: `export_credits`
   - Display Name: "Export Credits"
   
5. Add package to offering:
   - Identifier: `layers_export`
   - Product: Select `layers_export` product
   - Display Name: "Single Export"

### App Store Connect (iOS/macOS)
1. Go to App Store Connect > Your App > Subscriptions
2. Create consumable IAP:
   - Reference Name: "Export Credit"
   - Product ID: `com.connectio.layers.export_credit`
   - Price: Tier 1 ($0.99) or Tier 0 ($0.49 if available)
   - Type: Consumable

### Google Play Console (Android)
1. Go to Play Console > Your App > Monetize > Products > In-app products
2. Create managed product:
   - Product ID: `layers_export_credit`
   - Name: "Export Credit"
   - Price: $0.50 USD
   - Type: Consumable

### Testing Notes
- Test consumables in sandbox environment
- Android: Consumables can be repurchased without consuming (test quirk)
- iOS: Consumables must be consumed via API or they'll auto-restore
  </action>
  <verify>File created with complete configuration steps</verify>
  <done>Documentation file exists with platform-specific setup instructions</done>
</task>

<task type="auto">
  <name>Task 2: Update .env.example with new keys</name>
  <files>.env.example</files>
  <action>
Check if .env.example exists and ensure it documents the export credit product ID:

If file exists, add comment:
```
# RevenueCat Export Credit Product IDs (optional - for per-export pricing)
# REVENUECAT_EXPORT_PRODUCT_ID_IOS=com.connectio.layers.export_credit
# REVENUECAT_EXPORT_PRODUCT_ID_ANDROID=layers_export_credit
```

If file doesn't exist, create it with all required environment variables including the new export credit comments.
  </action>
  <verify>.env.example exists with export credit documentation</verify>
  <done>Environment example file updated with export credit configuration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] RevenueCat configuration documented
- [ ] Platform-specific setup instructions included (iOS, Android)
- [ ] Product IDs documented
- [ ] .env.example updated with export credit comments
</verification>

<success_criteria>

- RevenueCat dashboard configuration documented
- Platform-specific setup instructions (App Store Connect, Google Play) documented
- .env.example references export credit product configuration
- Ready to proceed with code implementation
  </success_criteria>

<output>
After completion, create `.planning/phases/20-per-export-pricing/20-02-SUMMARY.md`
</output>
