---
phase: 14-remove-layers-from-app-bar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [lib/widgets/app_shell.dart, lib/router/app_router.dart]
autonomous: true
---

<objective>
Remove "Layers" tab from the bottom navigation bar.

Purpose: Users access layers through the Project tab (after creating a project) or Export tab (for completed projects). The standalone Layers tab is redundant and clutters navigation.
Output: 3-tab navigation (Projects, Exports, Settings) with proper routing.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@lib/widgets/app_shell.dart
@lib/router/app_router.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove Layers tab from NavigationBar</name>
  <files>lib/widgets/app_shell.dart</files>
  <action>
    In AppShell widget:
    1. Remove the NavigationDestination for Layers (index 1) from the destinations list
    2. Update the remaining destinations to maintain proper order: Projects (0), Exports (1), Settings (2)
    3. The widget uses navigationShell.goBranch(index) - indices will automatically map to the new 3-branch structure after router changes
  </action>
  <verify>No compile errors in app_shell.dart</verify>
  <done>NavigationBar shows only 3 tabs: Projects, Exports, Settings</done>
</task>

<task type="auto">
  <name>Task 2: Remove Layers branch from router</name>
  <files>lib/router/app_router.dart</files>
  <action>
    In AppRouter:
    1. Remove the entire StatefulShellBranch for /layers from the branches list (keep the LayersScreen import if used elsewhere, or remove if not)
    2. Update branch order: Projects (index 0), Exports (index 1), Settings (index 2)
    3. Keep /layers route accessible via direct navigation (from ProjectScreen) but remove it as a top-level branch
    4. The /layers/export subroute should remain accessible - move it to be a subroute under /project if needed, or keep as standalone route outside the shell
    
    Note: LayersScreen is still needed - users navigate to it from ProjectScreen after creating a project. It just shouldn't be a tab.
  </action>
  <verify>flutter analyze lib/router/app_router.dart shows no errors</verify>
  <done>Router has 3 branches, /layers is accessible but not a tab</done>
</task>

<task type="auto">
  <name>Task 3: Verify navigation flow</name>
  <files>lib/screens/project_screen.dart</files>
  <action>
    1. Verify ProjectScreen still navigates to LayersScreen correctly after project creation
    2. Check that context.go('/layers') or context.push('/layers') is used appropriately
    3. If LayersScreen was accessed via tab index, update to use named route navigation
    4. Run the app and test: Create project → should navigate to layers view
  </action>
  <verify>flutter run -d macos, create a project, verify layers screen appears</verify>
  <done>Full flow works: Projects tab → create project → layers view</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] flutter analyze passes with no errors
- [ ] App runs without crashes
- [ ] Bottom nav shows 3 tabs only (Projects, Exports, Settings)
- [ ] Creating a project still navigates to layers view
- [ ] Export tab still works
- [ ] Settings tab still works
</verification>

<success_criteria>
- All tasks completed
- Navigation bar has 3 tabs instead of 4
- Layers functionality still accessible via project flow
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/14-remove-layers-from-app-bar/14-01-SUMMARY.md`
</output>
