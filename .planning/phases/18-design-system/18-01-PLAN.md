---
phase: 18-design-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [
  "lib/theme/app_theme.dart",
  "lib/theme/app_colors.dart",
  "lib/theme/app_typography.dart",
  "lib/theme/app_spacing.dart",
  "lib/main.dart",
  "pubspec.yaml"
]
autonomous: true
---

<objective>
Establish a distinctive, clean, light design system foundation for the Layers app.

Purpose: Transform the generic Material Design aesthetic into a refined, airy visual language that feels like a premium creative tool. This foundation enables consistent visual polish across all screens.

Output: Complete design system with custom colors, typography, spacing tokens, and updated app theme that applies throughout the app.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/milestones/v1.4-visual-overhaul.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md
@lib/main.dart
@lib/providers/theme_provider.dart
@lib/widgets/app_shell.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create design system structure and color palette</name>
  <files>lib/theme/app_colors.dart, lib/theme/app_theme.dart</files>
  <action>
Create a new `lib/theme/` directory with the design system foundation:

1. **lib/theme/app_colors.dart** - Define a refined, light color palette:
   - Primary: Deep indigo (#4F46E5) - distinctive but not default Material purple
   - Secondary: Soft teal (#14B8A6) - complementary accent
   - Background: Pure white (#FFFFFF) with subtle warm gray (#FAFAFA) for surfaces
   - Surface: Slightly elevated white (#FFFFFF) with subtle shadows
   - Text: Near-black (#1F2937) for primary text, medium gray (#6B7280) for secondary
   - Error: Soft red (#EF4444)
   - Success: Soft green (#10B981)
   
   Use const Color values, not MaterialColor. Define as a class with static const fields for easy theming.

2. **lib/theme/app_theme.dart** - Create custom ThemeData:
   - Light theme with the custom color scheme
   - Material3 enabled but customized
   - CardTheme with subtle elevation (1-2dp) and rounded corners (12dp)
   - ElevatedButtonTheme with custom styling
   - InputDecorationTheme for form fields
   - AppBarTheme with transparent background, no elevation
   - BottomNavigationBarTheme matching the airy aesthetic

Follow Flutter naming conventions (snake_case files, PascalCase classes). Use const constructors where possible.
  </action>
  <verify>
    - `flutter analyze` passes with no errors
    - Color constants are accessible and properly typed
    - ThemeData can be instantiated without errors
  </verify>
  <done>
    lib/theme/app_colors.dart exists with distinctive color palette
    lib/theme/app_theme.dart exists with custom ThemeData
    Files follow codebase conventions (snake_case, const where possible)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create typography and spacing systems</name>
  <files>lib/theme/app_typography.dart, lib/theme/app_spacing.dart</files>
  <action>
Create typography and spacing token files:

1. **lib/theme/app_spacing.dart** - Generous, intentional spacing tokens:
   - xs: 4.0 (micro adjustments)
   - sm: 8.0 (tight spacing)
   - md: 16.0 (standard spacing)
   - lg: 24.0 (section padding)
   - xl: 32.0 (large sections)
   - xxl: 48.0 (major divisions)
   - xxxl: 64.0 (hero sections)
   
   Define as a class with static const double fields. Also define EdgeInsets helpers (paddingAll, paddingHorizontal, paddingVertical) for common patterns.

2. **lib/theme/app_typography.dart** - Typography system:
   - Use Google Fonts package for distinctive typography
   - Display: Inter or similar clean sans-serif for headlines (not system default)
   - Body: Same family, different weights
   - Define text styles:
     - displayLarge: 32sp, FontWeight.w700 (hero text)
     - displayMedium: 24sp, FontWeight.w600 (section headers)
     - headlineLarge: 20sp, FontWeight.w600 (card titles)
     - headlineMedium: 18sp, FontWeight.w600 (subsections)
     - bodyLarge: 16sp, FontWeight.w400 (primary body)
     - bodyMedium: 14sp, FontWeight.w400 (secondary text)
     - labelLarge: 14sp, FontWeight.w600 (buttons, labels)
     - labelMedium: 12sp, FontWeight.w500 (captions)
   
   All with appropriate letter spacing (0.15 for body, -0.5 for display).

3. Update **pubspec.yaml** to add `google_fonts: ^6.1.0` dependency.

Follow the existing codebase pattern of manual definitions (no code generation for simple constants).
  </action>
  <verify>
    - `flutter pub get` succeeds after adding google_fonts
    - Typography styles are accessible and properly typed
    - Spacing values are const and usable
  </verify>
  <done>
    lib/theme/app_spacing.dart exists with generous spacing tokens
    lib/theme/app_typography.dart exists with distinctive font choices
    google_fonts added to pubspec.yaml
    All values are const and follow Flutter conventions
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate design system into app</name>
  <files>lib/main.dart, lib/theme/app_theme.dart</files>
  <action>
Integrate the new design system into the app:

1. Update **lib/main.dart**:
   - Import the new theme files: `import 'theme/app_theme.dart';`
   - Replace the inline ThemeData definitions with calls to AppTheme.lightTheme and AppTheme.darkTheme
   - Keep the seed color logic but use AppColors.primary as the seed
   - Ensure themeModeProvider still controls light/dark/system

2. Update **lib/theme/app_theme.dart**:
   - Add a complete AppTheme class with static methods:
     - `static ThemeData get lightTheme` - returns fully configured light theme
     - `static ThemeData get darkTheme` - returns fully configured dark theme (if supporting dark mode)
   - Include all component themes (Card, Button, Input, AppBar, NavigationBar)
   - Use AppColors, AppSpacing, and AppTypography in the theme configuration

3. Export all theme files from a barrel file **lib/theme/theme.dart** (optional but helpful):
   - Export app_colors.dart
   - Export app_typography.dart
   - Export app_spacing.dart
   - Export app_theme.dart

4. Verify the app still compiles and runs with `flutter run` (or at least `flutter build` for syntax check).

The design system should now be fully active - the app will use the new colors, spacing, and typography throughout.
  </action>
  <verify>
    - `flutter analyze` passes with no errors
    - `flutter build` succeeds (verifies no syntax errors)
    - App theme is properly configured and accessible
  </verify>
  <done>
    lib/main.dart uses AppTheme.lightTheme and AppTheme.darkTheme
    AppTheme class provides complete theme configuration
    All theme values (colors, spacing, typography) are integrated
    App compiles successfully
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `flutter analyze` passes with no errors
- [ ] `flutter build` succeeds for target platform
- [ ] All theme files follow codebase conventions (snake_case, const where possible)
- [ ] Design system is integrated and active in main.dart
- [ ] Colors are distinctive (not default Material palette)
- [ ] Spacing is generous (not cramped Material defaults)
- [ ] Typography uses Google Fonts (not system defaults)
</verification>

<success_criteria>
- Design system foundation complete with 4 theme files
- Distinctive color palette (deep indigo primary, soft teal accent)
- Generous spacing system (4-64pt scale)
- Custom typography using Google Fonts
- Theme integrated into app and active
- App compiles without errors
- Foundation ready for Phase 19 (Mobile UX) and Phase 20 (Screen Polish)
</success_criteria>

<output>
After completion, create `.planning/phases/18-design-system/18-01-SUMMARY.md`

Include:
- Design system structure overview
- Color palette choices and rationale
- Typography scale
- Spacing system
- Integration approach
- Files created/modified
</output>
