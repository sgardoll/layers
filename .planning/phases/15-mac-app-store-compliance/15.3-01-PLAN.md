---
phase: 15.3-mac-app-store-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [
  macos/Runner/DebugProfile.entitlements,
  macos/Runner/Release.entitlements
]
autonomous: false
domain: flutter
---

<objective>
Address Mac App Store Review feedback by removing unused entitlements and preparing for app icon redesign.

Purpose: Resolve Guideline 2.4.5(i) (unused entitlement) and prepare for Guideline 4.3 (app icon uniqueness).

Output: Clean entitlements files and icon design options for user approval.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
@~/.config/opencode/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@macos/Runner/DebugProfile.entitlements
@macos/Runner/Release.entitlements
@macos/Runner/Assets.xcassets/AppIcon.appiconset/Contents.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused downloads entitlement</name>
  <files>macos/Runner/DebugProfile.entitlements, macos/Runner/Release.entitlements</files>
  <action>
    Remove the unused entitlement `com.apple.security.files.downloads.read-write` from both macOS entitlements files.

    Steps:
    1. Read both entitlements files
    2. Remove the key entry: `<key>com.apple.security.files.downloads.read-write</key>` and its associated `<true/>` value
    3. Keep all other entitlements:
       - com.apple.security.app-sandbox
       - com.apple.security.network.client  
       - com.apple.security.files.user-selected.read-write
    4. Verify XML structure remains valid

    Note: This entitlement is not used by the app. The app only accesses user-selected files through the file picker, which uses the `user-selected` entitlement.
  </action>
  <verify>
    - Both entitlements files no longer contain `com.apple.security.files.downloads.read-write`
    - XML structure is valid (properly formatted plist)
    - All other required entitlements remain
  </verify>
  <done>Unused entitlement removed from both DebugProfile.entitlements and Release.entitlements</done>
</task>

<task type="checkpoint:decision" gate="blocking">
  <decision>App icon redesign strategy</decision>
  <context>
    Mac App Store Review (Guideline 4.3) states: "Your app icon is identical to the icons of other apps already submitted to the App Store. Apps that use the same icon make it difficult for users to find apps and are considered a form of spam."

    The current app icons need to be redesigned to be unique. Since this is creative work requiring design decisions, I need your input on the approach.
  </context>
  <options>
    <option id="option-a">
      <name>Variation on Current</name>
      <pros>Quick to implement, maintains brand continuity, likely faster approval</pros>
      <cons>May still risk similarity if not different enough, less distinctive</cons>
    </option>
    <option id="option-b">
      <name>Completely New Design</name>
      <pros>Guaranteed uniqueness, fresh look, no similarity concerns</pros>
      <cons>Requires design work, brand recognition reset, more time</cons>
    </option>
    <option id="option-c">
      <name>Text/Wordmark Icon</name>
      <pros>Very unique, clear branding, simple to implement</pros>
      <cons>Less visual impact at small sizes, may not match mobile icons</cons>
    </option>
  </options>
  <resume-signal>Select: option-a (variation), option-b (new design), or option-c (text icon), OR provide your own icon design files</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Mac App Store compliance fixes</what-built>
  <how-to-verify>
    1. Verify entitlements change:
       - Open macos/Runner/Release.entitlements
       - Confirm `com.apple.security.files.downloads.read-write` is removed
       - Verify other entitlements still present

    2. For app icon (after you provide design):
       - Build macOS app: flutter build macos
       - Check icon appears correctly in:
         * Finder (various sizes)
         * Dock
         * Launchpad
         * App Store listing
       - Verify icon looks distinct and professional at all sizes

    3. Test functionality:
       - Run app on macOS
       - Verify file picker still works (uses user-selected entitlement)
       - Verify network access works
       - No sandbox violations
  </how-to-verify>
  <resume-signal>Type "approved" when icon displays correctly and entitlements look good, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Unused entitlement removed from both entitlements files
- [ ] XML structure is valid (no parsing errors)
- [ ] User has provided/approved new app icon design
- [ ] New icons exported in all required sizes (16, 32, 64, 128, 256, 512, 1024)
- [ ] Icons placed in correct asset directories (macos and ios)
- [ ] flutter build macos succeeds
- [ ] App runs without sandbox violations
- [ ] Icon displays correctly in macOS UI
</verification>

<success_criteria>
- Unused downloads entitlement removed from macOS entitlements
- App icon redesigned to be unique (user-approved design)
- All icon sizes generated and placed correctly
- App builds and runs without errors
- macOS sandbox compliance maintained
- Ready for Mac App Store resubmission
</success_criteria>

<output>
After completion, create `.planning/phases/15-mac-app-store-compliance/15.3-01-SUMMARY.md`

Include:
- Entitlements changes made
- Icon design decision and rationale
- New icon files list
- Build verification results
- Resubmission checklist for Mac App Store
</output>
