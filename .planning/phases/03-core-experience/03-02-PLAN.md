# Plan 03-02: Layer Selection and Actions

## Goal
Implement layer selection, visibility toggle, reordering, and the layer list panel.

## Architecture

### Selection State
```dart
class LayerSelectionState {
  final String? selectedLayerId;
  final Set<String> hiddenLayerIds;
}
```

### Layer Actions
- **Select**: Tap layer in 3D view or list
- **Toggle visibility**: Eye icon in list
- **Reorder**: Drag in list (updates zIndex)
- **Delete**: Swipe or button (with undo)

## Implementation Steps

### Step 1: Selection Provider
File: `lib/providers/layer_selection_provider.dart`
- LayerSelectionNotifier extends StateNotifier
- Methods: select(id), deselect(), toggleVisibility(id), isHidden(id)
- Persists hidden state per project

### Step 2: Layer List Panel
File: `lib/widgets/layer_list/layer_list_panel.dart`
- Slidable panel from right edge (or bottom on mobile)
- Shows layer thumbnails in stack order
- Drag handle for reordering (ReorderableListView)
- Eye icon for visibility toggle
- Highlight selected layer

### Step 3: Layer List Item
File: `lib/widgets/layer_list/layer_list_item.dart`
- Thumbnail (48x48)
- Layer name/index
- Visibility toggle button
- Drag handle
- Selection indicator

### Step 4: Reordering Logic
File: `lib/providers/layers_provider.dart` (extend)
- reorderLayer(oldIndex, newIndex) method
- Updates zIndex for affected layers
- Persists to project state

### Step 5: Layer Actions Menu
File: `lib/widgets/layer_actions_menu.dart`
- Context menu on long-press or right-click
- Actions: Hide/Show, Move Up, Move Down, Delete
- Delete shows snackbar with Undo

### Step 6: Connect to 3D View
- Hidden layers render with 0.3 opacity in 3D view
- Selected layer shows glow/border effect
- Tapping layer in 3D view updates selection

## UI Behavior

### Selection
- Single tap → select (deselects previous)
- Tap selected → deselect
- Tap empty space → deselect all

### Visibility
- Hidden layers show in list with dimmed thumbnail
- Hidden layers show in 3D view at 30% opacity
- Can still select hidden layers

### Reordering
- Drag in list to reorder
- Visual feedback during drag
- Updates 3D view immediately

## Acceptance Criteria
- [ ] Tapping layer selects it (in 3D view and list)
- [ ] Eye icon toggles layer visibility
- [ ] Hidden layers appear dimmed (30% opacity)
- [ ] Drag to reorder in layer list
- [ ] Reorder reflects immediately in 3D view
- [ ] Delete with undo snackbar
- [ ] Selection synced between 3D view and list

## Files to Create
1. `lib/providers/layer_selection_provider.dart`
2. `lib/widgets/layer_list/layer_list_panel.dart`
3. `lib/widgets/layer_list/layer_list_item.dart`
4. `lib/widgets/layer_actions_menu.dart`

## Files to Modify
1. `lib/providers/layers_provider.dart` - add reorder method
2. `lib/widgets/layer_space/layer_card.dart` - selection/visibility styling
3. `lib/screens/layers_screen.dart` - add layer list panel
