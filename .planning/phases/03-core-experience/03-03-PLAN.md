# Plan 03-03: 2D Stack View Fallback

## Goal
Provide a simple 2D composite view for users who prefer traditional editing or when 3D is overwhelming.

## Architecture

### View Mode State
```dart
enum ViewMode { space3D, stack2D }
```

Toggle button in toolbar switches between modes.

## Implementation Steps

### Step 1: View Mode Provider
File: `lib/providers/view_mode_provider.dart`
- Simple StateProvider<ViewMode>
- Defaults to ViewMode.space3D
- Persists preference

### Step 2: Stack View Widget
File: `lib/widgets/stack_view/stack_view.dart`
- Traditional layer composite view
- All visible layers stacked (Stack widget)
- No transforms, just proper ordering
- Supports pan and zoom (InteractiveViewer)

### Step 3: Stack Layer Widget
File: `lib/widgets/stack_view/stack_layer.dart`
- Full-size layer image
- Opacity based on visibility state
- Selection border when selected
- GestureDetector for selection

### Step 4: View Toggle Button
File: `lib/widgets/view_toggle_button.dart`
- Icon button: cube (3D) â†” layers (2D)
- Tooltip explains mode
- Animated transition between icons

### Step 5: Layers Screen Integration
- Conditionally render LayerSpaceView or StackView
- Animated switcher for smooth transition
- Layer list panel works with both views

## UI Behavior

### 2D Stack View
- Layers composited in correct order
- Pan/zoom with InteractiveViewer
- Tap layer to select (topmost wins)
- Same layer list panel as 3D view

### Transitions
- AnimatedSwitcher between views
- 300ms crossfade

## Acceptance Criteria
- [ ] Toggle button switches between 3D and 2D views
- [ ] 2D view shows proper layer composite
- [ ] Pan and zoom work in 2D view
- [ ] Layer selection works in 2D view
- [ ] Hidden layers respect visibility in 2D view
- [ ] Smooth animated transition between views
- [ ] View preference persists

## Files to Create
1. `lib/providers/view_mode_provider.dart`
2. `lib/widgets/stack_view/stack_view.dart`
3. `lib/widgets/stack_view/stack_layer.dart`
4. `lib/widgets/view_toggle_button.dart`

## Files to Modify
1. `lib/screens/layers_screen.dart` - view mode switching
