# 02.1-01 Summary: Supabase Schema

## Status: COMPLETE

## What Was Done

### SQL Schema Created (`supabase/schema.sql`)

**Tables:**
- `projects` - user image → layering job (status: queued|processing|packaging|ready|failed)
- `project_layers` - generated layers with png_path, dimensions, z_index, visibility, transforms
- `exports` - async export jobs (pngs|zip|layersPack)

**Indexes:**
- `projects.user_id`, `projects.status`
- `project_layers.project_id`, `project_layers.z_index`
- `exports.project_id`, `exports.status`

**Row Level Security:**
- Users can only CRUD their own projects/layers/exports
- Anonymous users (user_id IS NULL) can access their session data
- Service role (BuildShip) bypasses RLS

**Realtime:**
- Enabled on `projects` and `exports` tables for status subscriptions

**Storage Buckets (manual setup required):**
- `source-images` - uploaded originals (private, 50MB)
- `layers` - generated PNGs (private, 50MB)
- `exports` - ZIP/layersPack (private, 200MB)
- `thumbnails` - gallery thumbs (public, 5MB)

## Files Created
- `supabase/schema.sql` - complete schema for copy-paste into Supabase SQL Editor

## Manual Steps Required
1. Create Supabase project at supabase.com
2. Run `schema.sql` in SQL Editor
3. Create storage buckets in Dashboard → Storage
4. Set up Database Webhooks for BuildShip triggers

## Decisions Made
- Using `user_id` nullable for anonymous/guest usage
- Storing paths in DB, actual files in Storage
- BuildShip uses service_role key (bypasses RLS)
