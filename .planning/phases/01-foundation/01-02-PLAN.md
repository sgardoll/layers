---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [lib/router/, lib/screens/, lib/providers/, ios/, android/, macos/, web/]
autonomous: true
---

<objective>
Create navigation structure and configure all platform targets.

Purpose: Establish the app shell with working navigation and ensure all platforms build correctly.
Output: App with bottom tabs navigation, placeholder screens, and all platform configs working.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create navigation structure with go_router</name>
  <files>lib/router/app_router.dart, lib/screens/project_screen.dart, lib/screens/layers_screen.dart, lib/screens/export_screen.dart, lib/screens/settings_screen.dart, lib/widgets/app_shell.dart</files>
  <action>
    1. Create AppRouter class with go_router configuration:
       - / → ProjectScreen (import image, create new project)
       - /project/:id → LayersScreen (main workspace with 3D/2D views)
       - /project/:id/export → ExportScreen (export options)
       - /settings → SettingsScreen
    
    2. Create AppShell widget (bottom navigation scaffold):
       - Bottom tabs: Project, Layers, Export, Settings
       - Use NavigationBar (Material 3) or custom bottom bar
       - Preserve state when switching tabs (use StatefulShellRoute)
    
    3. Create placeholder screens (minimal, just show title):
       - ProjectScreen: "Import or create a project"
       - LayersScreen: "3D Layer View" (will hold the signature viewer)
       - ExportScreen: "Export Options"
       - SettingsScreen: "Settings"
    
    4. Create router provider (Riverpod):
       - final routerProvider = Provider<GoRouter>((ref) => AppRouter.router);
    
    5. Update main.dart to use MaterialApp.router with the router provider
    
    AVOID: Don't overcomplicate routing — keep it flat for MVP.
    AVOID: Don't add authentication guards yet — that's post-MVP.
  </action>
  <verify>flutter run -d chrome shows app with working bottom navigation</verify>
  <done>All 4 tabs navigate correctly, state preserved on tab switch</done>
</task>

<task type="auto">
  <name>Task 2: Configure platform targets</name>
  <files>ios/Runner/Info.plist, android/app/src/main/AndroidManifest.xml, macos/Runner/Info.plist, macos/Runner/DebugProfile.entitlements, macos/Runner/Release.entitlements, web/index.html</files>
  <action>
    1. iOS (ios/Runner/Info.plist):
       - Set CFBundleDisplayName to "Layers"
       - Add NSPhotoLibraryUsageDescription (for image picker)
       - Add NSCameraUsageDescription (if camera capture later)
       - Set minimum iOS version to 14.0
    
    2. Android (android/app/src/main/AndroidManifest.xml):
       - Set android:label to "Layers"
       - Add INTERNET permission (for API calls)
       - Add READ_EXTERNAL_STORAGE permission (for image access)
       - Update compileSdkVersion to 34 in build.gradle
       - Set minSdkVersion to 24 (Android 7.0+)
    
    3. macOS (macos/Runner/):
       - Update Info.plist with app name "Layers"
       - Enable network access in entitlements (com.apple.security.network.client)
       - Enable file access for image import (com.apple.security.files.user-selected.read-write)
       - Set minimum macOS to 11.0
    
    4. Web (web/index.html):
       - Update title to "Layers"
       - Set theme-color meta tag
       - Update manifest.json with app name and icons placeholder
    
    5. Verify each platform builds:
       - `flutter build ios --simulator` (or just flutter run -d ios)
       - `flutter build apk --debug`
       - `flutter build macos --debug`
       - `flutter build web`
    
    AVOID: Don't add app icons yet — use Flutter defaults for now.
    AVOID: Don't configure signing/release builds — that's Phase 5.
  </action>
  <verify>All 4 platform builds complete without errors</verify>
  <done>iOS, Android, macOS, and web all build and run showing the app shell</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `flutter run -d chrome` works (web)
- [ ] `flutter run -d macos` works (macOS)
- [ ] `flutter build apk --debug` succeeds (Android)
- [ ] `flutter build ios --simulator` succeeds (iOS)
- [ ] Bottom navigation works on all platforms
- [ ] `flutter analyze` shows no errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- App shell with navigation works on all 4 platforms
- Platform permissions configured for image access and networking
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
