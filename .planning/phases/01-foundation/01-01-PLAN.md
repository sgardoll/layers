---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [pubspec.yaml, lib/core/, lib/models/, lib/services/, analysis_options.yaml]
autonomous: true
---

<objective>
Create Flutter project scaffold with clean architecture foundation.

Purpose: Establish the project structure, dependencies, and core abstractions that all features build on.
Output: Working Flutter project with state management, DI, and domain models ready.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Flutter project with dependencies</name>
  <files>pubspec.yaml, analysis_options.yaml, lib/main.dart</files>
  <action>
    1. Run `flutter create --org com.layers --project-name layers .` in current directory
    2. Update pubspec.yaml with dependencies:
       - flutter_riverpod (state management — simple, testable, no boilerplate)
       - go_router (declarative routing)
       - freezed + freezed_annotation + json_serializable (immutable models)
       - dio (HTTP client for API calls)
       - path_provider (file storage)
       - share_plus (share sheet integration)
       - image_picker (camera roll access)
       - cached_network_image (image caching)
       - flutter_animate (micro-animations)
    3. Dev dependencies: build_runner, freezed, json_serializable
    4. Update analysis_options.yaml with strict lints (flutter_lints + custom rules)
    5. Create folder structure:
       - lib/core/ (app-wide utilities, constants, extensions)
       - lib/models/ (domain models)
       - lib/services/ (API, storage, image processing)
       - lib/providers/ (Riverpod providers)
       - lib/screens/ (UI screens)
       - lib/widgets/ (reusable widgets)
    6. Update lib/main.dart with ProviderScope wrapper and placeholder app
    
    AVOID: Don't use GetX or BLoC — Riverpod is simpler for this scale.
    AVOID: Don't add unnecessary dependencies — keep it lean for quick builds.
  </action>
  <verify>flutter pub get succeeds, flutter analyze shows no errors</verify>
  <done>Project compiles, dependencies resolved, folder structure exists</done>
</task>

<task type="auto">
  <name>Task 2: Create core domain models and abstractions</name>
  <files>lib/models/layer.dart, lib/models/project.dart, lib/models/processing_state.dart, lib/core/result.dart</files>
  <action>
    1. Create Layer model (freezed):
       - id: String (UUID)
       - name: String
       - imagePath: String (local cache path)
       - remoteUrl: String? (signed URL from server)
       - width, height: int
       - transform: LayerTransform (x, y, scale, rotation, opacity)
       - zIndex: int
       - visible: bool
       - metadata: LayerMetadata? (confidence, createdAt)
    
    2. Create LayerTransform model (freezed):
       - x, y: double (position offset)
       - scale: double (1.0 = original)
       - rotation: double (radians)
       - opacity: double (0.0-1.0)
    
    3. Create Project model (freezed):
       - id: String (UUID)
       - name: String
       - sourceImagePath: String
       - layers: List<Layer>
       - createdAt, updatedAt: DateTime
       - settings: ProjectSettings (zGap, backgroundColor)
    
    4. Create ProcessingState enum:
       - idle, uploading, processing, packaging, ready, failed
    
    5. Create Result<T> sealed class for error handling:
       - Success<T>(data: T)
       - Failure<T>(error: String, code: String?)
    
    6. Run build_runner: `dart run build_runner build --delete-conflicting-outputs`
    
    AVOID: Don't add UI-specific fields to domain models.
    AVOID: Don't use nullable where a default makes sense.
  </action>
  <verify>dart run build_runner build succeeds, flutter analyze clean</verify>
  <done>All models compile, freezed generates .freezed.dart and .g.dart files</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `flutter pub get` succeeds
- [ ] `flutter analyze` shows no errors or warnings
- [ ] `dart run build_runner build` completes without errors
- [ ] All model files have generated .freezed.dart counterparts
- [ ] App runs on at least one platform (iOS simulator or web)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Clean Flutter project with architecture foundation ready
- Domain models defined and code-generated
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
