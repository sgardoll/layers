---
phase: 04-export-persistence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [lib/widgets/export_bottom_sheet.dart, lib/screens/export_screen.dart]
autonomous: true
---

<objective>
Wire export UI to Supabase export service.

Purpose: Enable users to create PNG/ZIP/layersPack exports through the Supabase-triggered BuildShip workflow.
Output: Working export flow: user selects format → INSERT to exports table → BuildShip builds → download ready.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@lib/services/supabase_export_service.dart
@lib/providers/supabase_providers.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ExportBottomSheet to use SupabaseExportService</name>
  <files>lib/widgets/export_bottom_sheet.dart</files>
  <action>Replace the old export_service.dart usage with supabase_export_service.dart. Use exportServiceProvider from supabase_providers.dart. Call createExport() which INSERTs to exports table. Show loading state while polling for completion. Display download button when asset_url is ready. Handle errors gracefully.</action>
  <verify>flutter analyze lib/widgets/export_bottom_sheet.dart shows no errors</verify>
  <done>ExportBottomSheet creates exports via Supabase, polls status, shows download when ready</done>
</task>

<task type="auto">
  <name>Task 2: Update ExportScreen with export history</name>
  <files>lib/screens/export_screen.dart</files>
  <action>Replace placeholder with list of user's exports from Supabase. Use SupabaseExportService.getExportsForProject(). Show export type, status, created date. Allow re-download of completed exports. Allow delete of exports. Use realtime subscription for status updates.</action>
  <verify>flutter analyze lib/screens/export_screen.dart shows no errors</verify>
  <done>ExportScreen shows export history with status, download links, delete option</done>
</task>

</tasks>

<verification>
- [ ] flutter analyze lib/widgets/export_bottom_sheet.dart - no errors
- [ ] flutter analyze lib/screens/export_screen.dart - no errors
- [ ] Export flow: select format → loading → download ready (requires Supabase + BuildShip setup)
</verification>

<success_criteria>
- ExportBottomSheet uses SupabaseExportService
- ExportScreen shows export history from Supabase
- No references to old export_service.dart
</success_criteria>

<output>
After completion, create `.planning/phases/04-export-persistence/04-01-SUMMARY.md`
</output>
