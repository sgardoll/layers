---
phase: 04-export-persistence
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [lib/screens/project_screen.dart, lib/providers/project_provider.dart]
autonomous: true
---

<objective>
Build project gallery with Supabase persistence.

Purpose: Enable users to see their projects, load previous work, and start new projects.
Output: Project gallery showing thumbnails, status, and layer count with tap-to-load functionality.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@lib/services/supabase_project_service.dart
@lib/providers/supabase_providers.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProjectProvider for gallery state</name>
  <files>lib/providers/project_provider.dart</files>
  <action>Create ProjectListNotifier using Riverpod. Methods: loadProjects(), createProject(imagePath), deleteProject(id). State: AsyncValue of List of Project. Use SupabaseProjectService. Subscribe to realtime updates for status changes. Handle loading, error, and empty states.</action>
  <verify>flutter analyze lib/providers/project_provider.dart shows no errors</verify>
  <done>ProjectListNotifier manages project list with CRUD operations and realtime updates</done>
</task>

<task type="auto">
  <name>Task 2: Update ProjectScreen with gallery grid</name>
  <files>lib/screens/project_screen.dart</files>
  <action>Replace placeholder with grid of project cards. Show thumbnail (from thumbnails bucket), status badge (queued/processing/ready/failed), layer count, created date. Tap to navigate to LayersScreen with project ID. FAB to create new project (image picker → upload → INSERT). Pull-to-refresh. Empty state with call-to-action.</action>
  <verify>flutter analyze lib/screens/project_screen.dart shows no errors</verify>
  <done>ProjectScreen shows gallery grid, supports create/load/delete, shows status badges</done>
</task>

</tasks>

<verification>
- [ ] flutter analyze lib/providers/project_provider.dart - no errors
- [ ] flutter analyze lib/screens/project_screen.dart - no errors
- [ ] Gallery shows projects from Supabase (requires Supabase setup)
</verification>

<success_criteria>
- ProjectListNotifier manages project state via SupabaseProjectService
- ProjectScreen displays gallery with thumbnails and status
- Create new project flow works (image picker → upload → INSERT)
- Tap project loads it into LayersScreen
</success_criteria>

<output>
After completion, create `.planning/phases/04-export-persistence/04-02-SUMMARY.md`
</output>
