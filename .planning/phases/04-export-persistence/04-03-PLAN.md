# Plan 04-03: Project Save/Load

## Goal
Users can save projects locally and reload them later without re-running inference.

## Context
- Projects are currently ephemeral (lost on app close)
- Need local storage for project state + cached layer images
- Should work offline after initial inference

## Tasks

### 1. Local Storage Structure
```
App Documents/
├── projects/
│   ├── {project-id}/
│   │   ├── project.json      # Project metadata + layer info
│   │   ├── original.png      # Original input image
│   │   ├── layers/
│   │   │   ├── 0.png
│   │   │   └── ...
│   │   └── thumbnail.png
│   └── {project-id-2}/
│       └── ...
└── projects_index.json       # List of all projects with thumbnails
```

### 2. Project Repository
Create `lib/services/project_repository.dart`:
- `saveProject(Project project)` → persists to local storage
- `loadProject(String id)` → loads from local storage
- `listProjects()` → returns all saved projects (for gallery)
- `deleteProject(String id)` → removes project and files
- `getProjectThumbnail(String id)` → returns thumbnail path

### 3. Auto-Save
- Save project automatically after inference completes
- Save on layer changes (debounced, every 5 seconds of inactivity)
- Save on app background/close

### 4. Project Gallery Screen
Update `lib/screens/project_screen.dart`:
- Show grid of saved projects with thumbnails
- Tap to open existing project
- Long-press for delete option
- "New Project" button to start fresh import

### 5. Project Provider
Create `lib/providers/project_repository_provider.dart`:
- Riverpod provider for ProjectRepository
- `currentProjectProvider` - the active project
- `projectsListProvider` - all saved projects

## Files to Create/Modify
- CREATE: `lib/services/project_repository.dart`
- CREATE: `lib/providers/project_repository_provider.dart`
- MODIFY: `lib/screens/project_screen.dart` (gallery UI)
- MODIFY: `lib/providers/job_provider.dart` (auto-save after inference)

## Verification
- [ ] Project saves to local storage with all layers
- [ ] Project loads correctly with cached layer images
- [ ] Gallery shows all saved projects with thumbnails
- [ ] Delete removes project and all associated files
- [ ] Auto-save triggers on changes and app lifecycle
- [ ] Works offline after initial save
